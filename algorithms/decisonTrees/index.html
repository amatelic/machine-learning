<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
  <script src= "https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script> -->
  <script src="./lib/jquery/dist/jquery.js"></script>
  <script src="./lib/underscore/underscore-min.js"></script>
  <script src="./lib/backbone/backbone-min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
</head>
<body>
  <div class="col-md-12 ">
    <div class="col-md-2">
      <p>Select csv file</p>
      <input id="file" type="file" name="name" >
    </div>
    <div class="col-md-5 dc-table">
    </div>
    <div class="col-md-5">
      <canvas id="canvas" width="700" height="700"></canvas>
    </div>
  </div>

  <script src="./decisonTree.js"></script>
  <script src="./drawTree.js"></script>
  <script type="text/javascript">
    var Table = Backbone.View.extend({
      tagName: 'table',
      className: 'table table-striped',
      render() {
        this.$el.html(`
          <thead>
            <tr><td style="text-align: center;" colspan="2">Decison tree-data<td></tr>
            <tr>
              ${this.createHeader(this.model)}
            </tr>
          <thead>
          <tbody>
            ${this.createTable(this.model)}
          </tbody>`);
        return this;
      },

      createHeader(collection) {
        return collection[0].reduce((str, n) => str+= '<td>' + n + '</td>', '');
      },

      createTable(col) {
        col = col.slice(1);
        var data = ('<tr><td>' + col.map((row) => row.join('</td><td>')).join('</tr><tr><td>') + '</td></tr>');
        return data;
      },

    });

    var file = document.querySelector('#file')
    var table = $('.dc-table');
    file.addEventListener('change', handleFileSelect, false);
    function handleFileSelect(evt) {
      var files = evt.target.files;
      if (files.length === 0) {
        return;
      }
      var file = files[0];
      var reader = new FileReader();
      reader.onloadend = function(evt) {
        if (evt.target.readyState == FileReader.DONE) { // DONE == 2
          var data = evt.target.result.split('\n').slice(0, -1).map(f => f.split(','));
          var tree = buildTree(data.slice(1), entropy);
          var dcgraph = new DecisonTreeGraph('#canvas', tree);
          dcgraph.show();
          table.html((new Table({model: data})).render().el)
          console.log(classify(['Sunny', 'Cool', null, null], tree ))
          console.log(mdclassify(['Sunny', 'Mill', null, null], tree))
        }
      }
      var blob = file.slice();
      console.log('reader: ', reader);
      reader.readAsBinaryString(blob);
    }
  </script>
</body>
</html>
